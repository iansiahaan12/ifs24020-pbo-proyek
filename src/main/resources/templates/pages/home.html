<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/base}" lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - My Collection</title>
</head>
<body>
    <div layout:fragment="content">
        
        <!-- BAGIAN 1: HEADER GRADIENT (SAPAAN) -->
        <div class="text-white pt-3 mb-5 shadow-sm" 
             style="background: linear-gradient(120deg,     #00f2be 0%, #f20c00a4 100%);
                    margin-top: -26px;
                    border-bottom-left-radius: 2rem; 
                    border-bottom-right-radius: 2rem; 
                    padding-bottom: 5rem;"> 
            <div class="container text-center">
                <h1 class="display-5 fw-bold mb-2">Halo, <span th:text="${auth.name}">User</span>! ðŸ‘‹</h1>
                <p class="lead opacity-75 mb-3">Selamat Datang di Koleksi Pribadimu.</p>
                
                <!-- CONTAINER TANGGAL & JAM -->
                <div class="d-flex justify-content-center gap-3 opacity-75 small">
                    
                    <!-- TANGGAL -->
                    <span>
                        <i class="far fa-calendar-alt me-1"></i> 
                        <span id="currentDate">Minggu...</span>
                    </span>

                    <span>|</span> <!-- Pemisah Vertikal -->

                    <!-- JAM -->
                    <span>
                        <i class="far fa-clock me-1"></i> 
                        <span id="currentTime" style="font-variant-numeric: tabular-nums;">--:--:--</span>
                    </span>
                </div>

            </div>
        </div>

        <!-- BAGIAN 2: CONTAINER KARTU -->
        <div class="container" style="margin-top: -40px;">
            <div class="row g-4 mb-5">
                
                <!-- KARTU 1: TOTAL ASET (Warna Hijau Emerald) -->
                <div class="col-md-6 col-lg-4">
                    <div class="card border-0 shadow h-100 overflow-hidden card-hover text-white"
                         style="background: linear-gradient(135deg, #5c9911 0%, #ef38e97b 100%);">
                        <div class="card-body p-4 position-relative">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <!-- Icon Background Putih Transparan -->
                                <div class="bg-white bg-opacity-25 rounded-circle p-3 text-white">
                                    <i class="fas fa-wallet fa-2x"></i>
                                </div>
                                <span class="badge bg-white bg-opacity-25 text-white px-3 py-2 rounded-pill">Keuangan</span>
                            </div>
                            <!-- Nilai Uang -->
                            <h3 class="fw-bold mb-0" th:text="'Rp ' + ${#numbers.formatDecimal(totalValue, 0, 'COMMA', 0, 'POINT')}">Rp 0</h3>
                            <small class="opacity-75">Total Nilai Aset</small>
                            
                            <!-- Dekorasi Icon Samar -->
                            <i class="fas fa-coins position-absolute opacity-10" style="font-size: 8rem; right: -20px; bottom: -20px;"></i>
                        </div>
                    </div>
                </div>

                <!-- KARTU 2: TOTAL ITEM (Warna Oranye Sunrise) -->
                <div class="col-md-6 col-lg-4">
                    <div class="card border-0 shadow h-100 overflow-hidden card-hover text-white"
                         style="background: linear-gradient(135deg, #070502 0%, #f2c94c 100%);">
                        <div class="card-body p-4 position-relative">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div class="bg-white bg-opacity-25 rounded-circle p-3 text-white">
                                    <i class="fas fa-boxes fa-2x"></i>
                                </div>
                                <span class="badge bg-white bg-opacity-25 text-white px-3 py-2 rounded-pill">Inventaris</span>
                            </div>
                            <!-- Jumlah Barang -->
                            <h3 class="fw-bold mb-0" th:text="${totalItems} + ' Barang'">0 Barang</h3>
                            <small class="opacity-75">Total Item Disimpan</small>

                            <!-- Dekorasi Icon Samar -->
                            <i class="fas fa-box-open position-absolute opacity-10" style="font-size: 8rem; right: -20px; bottom: -20px;"></i>
                        </div>
                    </div>
                </div>

                <!-- KARTU 3: KELOLA KOLEKSI (Warna Biru Laut - Tetap) -->
                <div class="col-md-12 col-lg-4">
                    <div class="card border-0 shadow h-100 text-white card-hover" 
                         style="background: linear-gradient(135deg, #2980b9 0%, #2c3e50 100%);">
                        <div class="card-body p-4 d-flex flex-column justify-content-center text-center">
                            <h4 class="fw-bold mb-3">Kelola Koleksi</h4>
                            <p class="mb-4 opacity-75">Tambah barang baru atau update data barang yang sudah ada.</p>
                            <a th:href="@{/items}" class="btn btn-light text-primary fw-bold w-100 stretched-link shadow-sm">
                                <i class="fas fa-arrow-right me-2"></i> Buka Daftar Koleksi
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BAGIAN 3: BARANG TERBARU -->
            <div class="row justify-content-center mb-5">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="fw-bold text-secondary mb-0"><i class="fas fa-history me-2"></i> Baru Ditambahkan</h5>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-12 text-center py-4" th:if="${recentItems.empty}">
                            <p class="text-muted">Belum ada barang. Yuk tambah sekarang!</p>
                        </div>

                        <div class="col-md-4" th:each="item : ${recentItems}">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body d-flex align-items-center">
                                    <div class="me-3">
                                        <img th:if="${item.imagePath != null}" th:src="@{/items/image/{file}(file=${item.imagePath})}" 
                                             class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                        <div th:unless="${item.imagePath != null}" class="bg-light rounded d-flex justify-content-center align-items-center" style="width: 50px; height: 50px;">
                                            <i class="fas fa-box text-secondary"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-0 text-truncate" style="max-width: 150px;" th:text="${item.itemName}">Item</h6>
                                        <small class="text-muted" th:text="${item.category}">Kategori</small>
                                    </div>
                                    <div class="ms-auto">
                                        <span class="badge bg-light text-dark border" th:text="${item.condition}">Baru</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BAGIAN 4: LOGOUT -->
            <div class="text-center pb-5">
                <form th:action="@{/auth/logout}" method="post">
                    <button type="submit" class="btn btn-link text-danger text-decoration-none fw-bold px-4 py-2">
                        <i class="fas fa-sign-out-alt me-2"></i> Keluar dari Aplikasi
                    </button>
                </form>
            </div>

    <!-- Script Tanggal & Jam -->
        <th:block layout:fragment="scripts">
            <script>
                function updateTime() {
                    const now = new Date();
                    
                    // 1. Update Tanggal (Hanya sekali saat load sebenarnya cukup, tapi ditaruh sini juga aman)
                    const dateElement = document.getElementById('currentDate');
                    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    if(dateElement) dateElement.innerText = now.toLocaleDateString('id-ID', dateOptions);

                    // 2. Update Jam (Setiap Detik)
                    const timeElement = document.getElementById('currentTime');
                    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }; // hour12: false agar format 24 jam (13:00)
                    if(timeElement) {
                        // Mengganti titik (.) dengan titik dua (:) agar tampilan jam standar (13:30:05)
                        let timeString = now.toLocaleTimeString('id-ID', timeOptions).replace(/\./g, ':');
                        timeElement.innerText = timeString + " WIB"; // Opsional: Tambah zona waktu jika mau
                    }
                }

                // Jalankan fungsi updateTime setiap 1 detik (1000 ms)
                setInterval(updateTime, 1000);
                
                // Jalankan sekali saat halaman pertama kali dibuka (biar tidak nunggu 1 detik baru muncul)
                updateTime();
            </script>
        </th:block>

    <!-- Style CSS -->
    <style layout:fragment="custom-css">
        /* 1. BACKGROUND SOFT NAVY (Versi Lebih Jelas) */
        body {
        background-color: #F0F2F5 !important;  

        }

        /* 2. Kartu agar 'muncul' */
        .card {
            /* Beri sedikit border agar kartu tidak tenggelam */
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        /* Mode Gelap (Tetap) */
        [data-bs-theme="dark"] body {
            background-color: #0f172a !important; 
            background-image: radial-gradient(rgba(255,255,255, 0.1) 1.5px, transparent 1.5px) !important;
        }
        [data-bs-theme="dark"] .card {
            border-color: #334155;
            background-color: #1e293b;
        }

        /* Hover Effect */
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15) !important;
        }

        .opacity-10 { opacity: 0.1; }
        .opacity-75 { opacity: 0.75; }
    </style>
</body>
</html>